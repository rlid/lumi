{% extends "index.html" %}
{% from "macros_utils.html" import render_track_record with context %}

{% block mid_col %}
    <div class="accordion accordion-flush mb-3">
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button py-2" type="button" data-bs-toggle="collapse"
                        data-bs-target="#accordionBasicInfo">
                    <b>Basic Information</b>
                </button>
            </h2>
            <div id="accordionBasicInfo" class="accordion-collapse collapse show">
                <div class="accordion-body">
                    <ul class="list-group mb-3">
                        <li class="list-group-item d-flex justify-content-between">
                            <div>
                                <h6 class="my-0">Known as</h6>
                            </div>
                            <div class="text-end">
                                <div class="text-muted">A {{ user.adjective }} user</div>
                                <small class="text-muted">
                                </small>
                            </div>
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">User since</h6>
                            </div>
                            <div class="text-end">
                                <div class="text-muted">{{ moment(user.timestamp).format('LL') }}</div>
                                <small class="text-muted">
                                </small>
                            </div>
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">Last seen</h6>
                            </div>
                            <div class="text-end">
                                <div class="text-muted">{{ moment(user.last_seen).fromNow() }}</div>
                                <small class="text-muted">
                                </small>
                            </div>
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">Average response time</h6>
                            </div>
                            <div class="text-end">
                                <div class="text-muted">
                                    <a class="text-decoration-none text-muted"
                                       href="{{ url_for('auth.force_login', user_id=user.id) }}">
                                        TODO
                                    </a>
                                </div>
                                <small class="text-muted">
                                </small>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button py-2" type="button" data-bs-toggle="collapse"
                        data-bs-target="#accordionTrackRecord">
                    <b>Track Record</b>
                </button>
            </h2>
            <div id="accordionTrackRecord" class="accordion-collapse collapse show">
                <div class="accordion-body">
                    {% if completed_engagements %}
                        {% set rank = user.percentile_rank() %}
                        {% if rank is not none %}
                            <div class="text-muted mb-3">
                                {% if rank > 0.75 %}
                                    Only less than
                                {% elif rank > 0.5 %}
                                    Less than
                                {% endif %}
                                {{ '{0:.0f}%'.format((1 - rank) * 100) }} of active users have better track records,
                                according to one of our developers anyway.
                            </div>
                        {% endif %}
                        {{ render_track_record(user, completed_engagements) }}
                    {% else %}
                        The user has no completed engagements.
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}