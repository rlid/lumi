{% extends "index.html" %}
{% from "macros_models.html" import render_engagement with context %}

{% block mid_col %}
    <div class="accordion accordion-flush mb-3">
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button py-2" type="button" data-bs-toggle="collapse"
                        data-bs-target="#accordionBasicInfo">
                    <b>Account Information</b>
                </button>
            </h2>
            <div id="accordionBasicInfo" class="accordion-collapse collapse show">
                <div class="accordion-body">
                    <ul class="list-group mb-3">
                        <li class="list-group-item d-flex justify-content-between">
                            <div>
                                <h6 class="my-0">Known As</h6>
                            </div>
                            <div class="text-end">
                                <div class="text-muted">A {{ user.adjective }} user</div>
                                <span class="text-muted">
                                    <a class="badge btn-primary text-decoration-none"
                                       href="{{ url_for('main.user', user_id=current_user.id) }}">My Public Profile</a>
                                </span>
                            </div>
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">Balance Available</h6>
                            </div>
                            <div class="text-end">
                                <div class="text-muted">{{ '${0:.2f}'.format(user.total_balance - user.reserved_balance) }}</div>
                                <span>
                                    <a class="badge btn-success text-decoration-none text-white"
                                       href="{{ url_for('main.top_up', price_id=config['STRIPE_PRICE_5']) }}">Top-up
                                        $5</a>
                                    <a class="badge btn-warning text-decoration-none text-white"
                                       href="{{ url_for('main.top_up', price_id=config['STRIPE_PRICE_10']) }}">Top-up
                                        $10</a>
                                    <a class="badge btn-danger text-decoration-none text-white"
                                       href="{{ url_for('main.top_up', price_id=config['STRIPE_PRICE_20']) }}">Top-up
                                        $20</a>
                                </span>
                            </div>
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">Engagement Value Limit</h6>
                                <small class="text-muted"></small>
                            </div>
                            <span class="text-muted">{{ '${0:.2f}'.format(user.reward_limit) }}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button py-2 {% if not uncompleted_engagements %}collapsed{% endif %}"
                        type="button" data-bs-toggle="collapse"
                        data-bs-target="#accordionActiveEngagements">
                    <b>Active Engagements</b>
                </button>
            </h2>
            <div id="accordionActiveEngagements" class="accordion-collapse collapse
                {% if uncompleted_engagements %}show{% endif %}">
                <div class="accordion-body pe-0 pt-0">
                    <div class="accordion accordion-flush">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button py-1"
                                        type="button" data-bs-toggle="collapse"
                                        data-bs-target="#accordionActiveEngagementsMyPosts">
                                    <small><b>Posts by you</b></small>
                                </button>
                            </h2>
                            <div id="accordionActiveEngagementsMyPosts" class="accordion-collapse collapse show">
                                <div class="accordion-body">
                                    {% set ns = namespace(empty=True) %}
                                    {% for engagement in uncompleted_engagements %}
                                        {% if engagement.node.post.creator == current_user %}
                                            {{ render_engagement(engagement) }}
                                            {% set ns.empty = False %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if ns.empty %}
                                        <small class="text-muted">
                                            There are no active engagements on the posts you have created.
                                        </small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="accordion accordion-flush">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button py-1"
                                        type="button" data-bs-toggle="collapse"
                                        data-bs-target="#accordionActiveEngagementsOtherPosts">
                                    <small><b>Posts by others</b></small>
                                </button>
                            </h2>
                            <div id="accordionActiveEngagementsOtherPosts" class="accordion-collapse collapse show">
                                <div class="accordion-body">
                                    {% set ns = namespace(empty=True) %}
                                    {% for engagement in uncompleted_engagements %}
                                        {% if engagement.node.post.creator != current_user %}
                                            {{ render_engagement(engagement) }}
                                            {% set ns.empty = False %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if ns.empty %}
                                        <small class="text-muted">
                                            There are no active engagements involving you on the posts created by
                                            others.
                                        </small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button py-2 {% if not nodes %}collapsed{% endif %}"
                        type="button" data-bs-toggle="collapse"
                        data-bs-target="#accordionActiveInteractions">
                    <b>Posts - Active</b>
                </button>
            </h2>
            <div id="accordionActiveInteractions" class="accordion-collapse collapse {% if nodes %}show{% endif %}">
                <div class="accordion-body pe-0 pt-0">
                    <div class="accordion accordion-flush">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button py-1"
                                        type="button" data-bs-toggle="collapse"
                                        data-bs-target="#accordionActiveInteractionsMyPosts">
                                    <small><b>Posts by you</b></small>
                                </button>
                            </h2>
                            <div id="accordionActiveInteractionsMyPosts" class="accordion-collapse collapse show">
                                <div class="accordion-body">
                                    {% set ns = namespace(empty=True) %}
                                    {% for node in nodes if node.parent is none and not node.post.is_archived %}
                                        {{ render_post_card(node, truncate_body=True, buttons=False, tag_limit=4) }}
                                        {% set ns.empty = False %}
                                    {% endfor %}
                                    {% if ns.empty %}
                                        <small class="text-muted">
                                            There are no other posts you have created that are open to contributions.
                                        </small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="accordion accordion-flush">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button py-1"
                                        type="button" data-bs-toggle="collapse"
                                        data-bs-target="#accordionActiveInteractionsOtherPosts">
                                    <small><b>Posts by others</b></small>
                                </button>
                            </h2>
                            <div id="accordionActiveInteractionsOtherPosts" class="accordion-collapse collapse show">
                                <div class="accordion-body">
                                    {% set ns = namespace(empty=True) %}
                                    {% for node in nodes if node.parent is not none and not node.post.is_archived %}
                                        {{ render_post_card(node, truncate_body=True, buttons=False, tag_limit=4) }}
                                        {% set ns.empty = False %}
                                    {% endfor %}
                                    {% if ns.empty %}
                                        <small class="text-muted">
                                            There are no other posts you have interacted with that are open to
                                            contributions.
                                        </small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button py-2 collapsed"
                        type="button" data-bs-toggle="collapse"
                        data-bs-target="#accordionInactiveInteractions">
                    <b>Posts - Archived</b>
                </button>
            </h2>
            <div id="accordionInactiveInteractions" class="accordion-collapse collapse">
                <div class="accordion-body pe-0 pt-0">
                    <div class="accordion accordion-flush">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button py-1"
                                        type="button" data-bs-toggle="collapse"
                                        data-bs-target="#accordionInactiveInteractionsMyPosts">
                                    <small><b>Posts by you</b></small>
                                </button>
                            </h2>
                            <div id="accordionInactiveInteractionsMyPosts" class="accordion-collapse collapse show">
                                <div class="accordion-body">
                                    {% set ns = namespace(empty=True) %}
                                    {% for node in nodes if node.parent is none and node.post.is_archived %}
                                        {{ render_post_card(node, truncate_body=True, buttons=False, tag_limit=4) }}
                                        {% set ns.empty = False %}
                                    {% endfor %}
                                    {% if ns.empty %}
                                        <small class="text-muted">
                                            There are no posts you have created that are archived.
                                        </small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion accordion-flush">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button py-1"
                                        type="button" data-bs-toggle="collapse"
                                        data-bs-target="#accordionInactiveInteractionsOtherPosts">
                                    <small><b>Posts by others</b></small>
                                </button>
                            </h2>
                            <div id="accordionInactiveInteractionsOtherPosts" class="accordion-collapse collapse show">
                                <div class="accordion-body">
                                    {% set ns = namespace(empty=True) %}
                                    {% for node in nodes if node.parent is not none and node.post.is_archived %}
                                        {{ render_post_card(node, truncate_body=True, buttons=False, tag_limit=4) }}
                                        {% set ns.empty = False %}
                                    {% endfor %}
                                    {% if ns.empty %}
                                        <small class="text-muted">
                                            There are no posts you have interacted with that are archived.
                                        </small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}