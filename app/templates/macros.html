{% macro bootstrap_css() %}
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
{% endmacro %}


{% macro bootstrap_js() %}
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous" async></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->
{% endmacro %}


{% macro ios_meta(app_title) %}
    <meta name="apple-mobile-web-app-title" content="{{ app_title }}">
{% endmacro %}


{% macro favicon_meta() %}
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
{% endmacro %}


{% macro render_nav_item(endpoint=None, text=None, icon=None, link=None) %}
    {% set active = True if request.endpoint and request.endpoint == endpoint else False %}
    <li class="nav-item text-nowrap rounded btn-outline-success">
        <a class="nav-link text-center {% if active %}text-light{% endif %}"
           href="{% if link %}{{ link }}{% else %}{{ url_for(endpoint, **kwargs) }}{% endif %}">
            {% if icon %}<i class="bi {{ icon }} me-1"></i>{% endif %}{{ text }}</a>

    </li>
{% endmacro %}


{% macro render_navbar(current_user=None) %}
    <nav class="navbar sticky-top navbar-expand-md navbar-dark bg-dark">
        <div class="container-fluid">
            <a class='navbar-brand mb-0 h1 fs-2' href='{{ url_for('main.index') }}'>
                <img src='{{ url_for('static', filename='apple-touch-icon.png') }}' width='38' height='38'
                     class='d-inline-block align-text-bottom'>{{ config["APP_NAME"][1:] }}</a>
            <button class="navbar-toggler my-1" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav my-1">
                    {{ render_nav_item("main.new_post", "Post", "bi-plus-square") }}
                    {{ render_nav_item("main.browse", "Browse", "bi-search") }}
                    {{ render_nav_item(text="Support", icon="bi-chat", link="https://discord.gg/xtXCScr9") }}
                    {{ render_nav_item("main.privacy", "Privacy Policy", "bi-camera-video-off") }}
                    {{ render_nav_item(text="About Us", icon="bi-info-circle", link="https://www.linkedin.com/company/knowbleapp") }}
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item my-1">
                        <div class="btn-group d-flex" role="group">

                            {% if current_user and current_user.is_authenticated %}
                                <a class="btn text-nowrap btn-success" href="{{ url_for('auth.logout') }}">
                                    Log Out</a>
                            {% else %}
                                <a class="btn text-nowrap btn-outline-success" href="{{ url_for('auth.login') }}">
                                    Log In
                                </a>
                                <a class="btn text-nowrap btn-success" href="{{ url_for('auth.signup') }}">
                                    Sign Up
                                </a>
                            {% endif %}
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
{% endmacro %}


{% macro render_footer(is_fixed=True) %}
    <div class="container {% if is_fixed %} fixed-bottom {% endif %}">
        <footer>
            <ul class="nav justify-content-center mb-2">
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">How It Works</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Why Use {{ config["APP_NAME"] }}?</a>
                </li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Community Guidelines</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Privacy Policy</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About Us</a></li>
            </ul>
            <div class="d-flex justify-content-between py-3 border-top">
                <p class="text-muted">&copy; 2022 {{ config["APP_NAME"] }} by Knowble</p>
                <ul class="list-unstyled d-flex">
                    <li class="ms-3"><a class="link-dark" href="#">
                        <i class="bi bi-twitter"></i>
                    </a></li>
                    <li class="ms-3"><a class="link-dark" href="#">
                        <i class="bi bi-linkedin"></i>
                    </a></li>
                    <li class="ms-3"><a class="link-dark" href="#">
                        <i class="bi bi-reddit"></i>
                    </a></li>
                    <li class="ms-3"><a class="link-dark" href="#">
                        <i class="bi bi-discord"></i>
                    </a></li>
                </ul>
            </div>
        </footer>
    </div>
{% endmacro %}


{# only visible if screen width is visible_from or more #}
{% macro render_nav_item_bottom(endpoint=None, text=None, icon=None, visible_from=None, link=None, num=0) %}
    {% set active = True if request.endpoint and request.endpoint == endpoint else False %}
    <li class="btn-secondary position-relative {% if text %}btn-sm{% endif %} text-center px-0 py-0 rounded-0 {% if active %}active{% endif %} {% if visible_from %}d-none d-{{ visible_from }}-block{% endif %}">
        <a href="{% if link %}{{ link }}{% else %}{{ url_for(endpoint, **kwargs) }}{% endif %}"
           class="nav-link text-light">{% if icon %}
            <i class="bi {{ icon }}"></i><br>{% endif %}{% if text %}{{ text|safe }}{% endif %}</a>
        {% if num > 0 %}
            <span class="position-absolute top-0 start-50 translate-middle badge rounded-pill bg-danger">{{ num }}</span>
        {% endif %}
    </li>
{% endmacro %}


{% macro render_navbar_bottom(current_user=None) %}
    <div class="container-fluid fixed-bottom bg-secondary">
        <ul class="nav justify-content-center">
            {% if current_user and current_user.is_authenticated %}
                {{ render_nav_item_bottom("main.new_post", "Post", "bi-plus-square") }}
                {{ render_nav_item_bottom("main.alerts", "Alerts", "bi-bell", num=5) }}
                {{ render_nav_item_bottom("main.conversations", "Chats", "bi-chat-square-text") }}
                {{ render_nav_item_bottom("main.account", "&nbsp&nbspMe&nbsp&nbsp", "bi-person-circle") }}
                {{ render_nav_item_bottom("main.browse", "Browse", "bi-search", "sm") }}
                {{ render_nav_item_bottom("main.saved", "Saved", "bi-bookmark-check", "sm") }}
            {% else %}
                {{ render_nav_item_bottom(link="https://twitter.com/KnowbleApp", icon="bi-twitter") }}
                {{ render_nav_item_bottom(link="https://fb.me/KnowbleApp", icon="bi-facebook") }}
                {{ render_nav_item_bottom(link="https://www.linkedin.com/company/knowbleapp", icon="bi-linkedin") }}
                {{ render_nav_item_bottom(link="https://discord.gg/xtXCScr9", icon="bi-discord") }}
                {{ render_nav_item_bottom(link="mailto:info@lumiask.com", icon="bi-envelope-fill") }}
            {% endif %}
        </ul>
    </div>
{% endmacro %}


{% macro render_user(user, capitalize=True) %}
    <a class="text-decoration-none text-muted" href="{{ url_for("main.user", user_id=user.id) }}">
        {% if user == current_user %}{{ "You" if capitalize else "you" }}{% else %}A user{% endif %}
    </a>
{% endmacro %}

{% macro render_post_tag(post_tag, freq=None) %}
    <a class="badge bg-light text-dark rounded-pill border text-decoration-none" href="{{ url_for("main.index") }}">
        #{{ post_tag.tag.name }}
        {% if freq %}
            <small>({{ post_tag.tag.post_tags.count() }})</small>
        {% endif %}
    </a>
{% endmacro %}

{% macro render_post_tags(post_tags) %}
    {% for post_tag in post_tags[:5] %}
        {{ render_post_tag(post_tag) }}
    {% endfor %}
{% endmacro %}

{% macro render_post_card(post, truncate_body=False, post_badges=True, post_tags=True) %}
    <div class="card me-3 mb-4">
        <div class="card-body py-2">
            {#            <a href="{{ url_for("main.view_post", post_id=post.id) }}"#}
            {#               class="position-absolute top-0 start-0 translate-middle btn badge rounded-pill {{ "btn-info" if post.is_request else "btn-warning" }}">#}
            {#                {{ "Buying" if post.is_request else "Selling" }}#}
            {#            </a>#}
            <span class="position-absolute top-0 start-100 translate-middle badge text-secondary rounded-pill"
                  style="background-color: rgb(240,240,240)">
                {{ "$%.2f"|format(0.01 * post.reward) }}
            </span>
            <p class="small text-muted mb-1">{{ render_user(post.creator) }}
                posted {{ moment(post.timestamp).fromNow() }}</p>
            <div class="card-title">
                <a href="{{ url_for("main.view_post", post_id=post.id) }}"
                   class="btn badge {{ "btn-info" if post.is_request else "btn-warning" }}">
                    {{ "Buying" if post.is_request else "Selling" }}
                </a>
                <a class="text-decoration-none text-dark"
                   href="{{ url_for("main.view_post", post_id=post.id) }}">
                    <b>{{ post.title }}</b>
                </a>
                <p class="mt-1 mb-0">{% if post_tags %} {{ render_post_tags(post.post_tags) }} {% endif %}</p>
            </div>
            <div class="card-text" {{ 'style="max-height: 8rem;overflow: hidden"'|safe if truncate_body }}>
                {% if truncate_body %}
                    <a class="text-decoration-none text-dark small"
                       href="{{ url_for("main.view_post", post_id=post.id) }}">
                {% endif %}
                {% if post.body_html %}
                    {{ post.body_html | safe }}
                {% else %}
                    {{ post.body }}
                {% endif %}
                {% if truncate_body %}
                    </a>
                {% endif %}
            </div>
        </div>
        {% if post_badges %}
            <div class="card-footer pt-0 bg-white border-0">
                <a href="{{ url_for("main.view_post", post_id=post.id) }}" class="btn btn-light btn-sm">
                    Chat
                </a>
                <a href="{{ url_for("main.view_post", post_id=post.id) }}" class="btn btn-light btn-sm">
                    Share
                </a>
                <a href="{{ url_for("main.view_post", post_id=post.id) }}" class="btn btn-light btn-sm">
                    Comment
                </a>
                <a href="{{ url_for("main.view_post", post_id=post.id) }}" class="btn btn-light btn-sm">
                    Report
                </a>
            </div>
        {% endif %}
    </div>
{% endmacro %}
