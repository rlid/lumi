{% macro bootstrap_css() %}
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
{% endmacro %}


{% macro bootstrap_js() %}
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous" async></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->
{% endmacro %}


{% macro ios_meta(app_title) %}
    <meta name="apple-mobile-web-app-title" content="{{ app_title }}">
{% endmacro %}


{% macro favicon_meta() %}
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
{% endmacro %}

{% macro smalltalk_js() %}
    <script src="https://embed.small.chat/T0302G8MBB4C02V1UES8G7.js" async></script>
{% endmacro %}

{% macro hotjar_js() %}
    <!-- Hotjar Tracking Code for https://lumiask.com -->
    <script>
        (function (h, o, t, j, a, r) {
            h.hj = h.hj || function () {
                (h.hj.q = h.hj.q || []).push(arguments)
            };
            h._hjSettings = {hjid: 2822982, hjsv: 6};
            a = o.getElementsByTagName('head')[0];
            r = o.createElement('script');
            r.async = 1;
            r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
            a.appendChild(r);
        })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');
    </script>
{% endmacro %}


{% macro render_nav_item(endpoint=None, text=None, icon=None, link=None, visible_from=None) %}
    {% set active = True if request.endpoint and request.endpoint == endpoint else False %}
    <li class="nav-item">
        <a class="nav-link text-nowrap rounded btn-outline-success rounded-0
            {% if active %}text-light{% endif %}
            {% if visible_from %}d-none d-{{ visible_from }}-block{% endif %}"
           style="padding-top: 11px;padding-bottom: 11px"
           href="{% if link %}{{ link }}{% else %}{{ url_for(endpoint, **kwargs) }}{% endif %}">
            {% if icon %}<i class="bi {{ icon }} me-1"></i>{% endif %}{{ text }}</a>

    </li>
{% endmacro %}


{% macro render_navbar(current_user=None) %}
    <nav class="navbar sticky-top-lg navbar-expand-sm navbar-dark bg-dark py-0">
        <div class="container-fluid">
            <a class='navbar-brand h1 my-0' href='{{ url_for('main.index') }}'>
                <img src='{{ url_for('static', filename='apple-touch-icon.png') }}' width='30' height='30'
                     class='d-inline-block align-text-bottom'>{{ config["APP_NAME"][1:] }}</a>
            <ul class="navbar-nav">
                {{ render_nav_item("main.browse", "Explore", "bi-search", visible_from="md") }}
                {{ render_nav_item("main.new_post", "Post", "bi-plus-square", visible_from="md") }}
                {{ render_nav_item("main.how_it_works", "How It Works", "bi-signpost-split", visible_from="md") }}
                {{ render_nav_item(text="Support", icon="bi-chat", link="https://discord.gg/PC7mPwXYsY", visible_from="md") }}
            </ul>
            <ul class="navbar-nav ms-auto py-2">
                <li class="nav-item">
                    <div class="btn-group" role="group">
                        {% if current_user and current_user.is_authenticated %}
                            <a class="btn btn-sm text-nowrap btn-outline-success text-white"
                               href="{{ url_for('main.account') }}">
                                Account
                            </a>
                            <a class="btn btn-sm text-nowrap btn-success"
                               href="{{ url_for('auth.logout') }}">
                                Log Out
                            </a>
                        {% else %}
                            <a class="btn btn-sm text-nowrap btn-outline-success text-white"
                               href="{{ url_for('auth.login') }}">
                                Log In
                            </a>
                            <a class="btn btn-sm text-nowrap btn-success"
                               href="{{ url_for('auth.signup') }}">
                                Sign Up
                            </a>
                        {% endif %}
                    </div>
                </li>
            </ul>
        </div>
    </nav>
{% endmacro %}


{% macro render_footer(is_fixed=True) %}
    <div class="container {% if is_fixed %} fixed-bottom {% endif %}">
        <footer>
            <ul class="nav justify-content-center mb-2">
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">How It Works</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Why Use {{ config["APP_NAME"] }}?</a>
                </li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Community Guidelines</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Privacy Policy</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About Us</a></li>
            </ul>
            <div class="d-flex justify-content-between py-3 border-top">
                <p class="text-muted">&copy; 2022 {{ config["APP_NAME"] }} by Knowble</p>
                <ul class="list-unstyled d-flex">
                    <li class="ms-3"><a class="link-dark" href="#">
                        <i class="bi bi-twitter"></i>
                    </a></li>
                    <li class="ms-3"><a class="link-dark" href="#">
                        <i class="bi bi-linkedin"></i>
                    </a></li>
                    <li class="ms-3"><a class="link-dark" href="#">
                        <i class="bi bi-reddit"></i>
                    </a></li>
                    <li class="ms-3"><a class="link-dark" href="#">
                        <i class="bi bi-discord"></i>
                    </a></li>
                </ul>
            </div>
        </footer>
    </div>
{% endmacro %}


{# only visible if screen width is visible_from or more #}
{% macro render_nav_item_bottom(endpoint=None, text=None, icon=None, visible_from=None, link=None, badge_text=0) %}
    {% set active = True if request.endpoint and request.endpoint == endpoint else False %}
    <li class="btn-secondary position-relative {% if text %}btn-sm{% endif %} text-center px-0 py-0 rounded-0 {% if active %}active{% endif %} {% if visible_from %}d-none d-{{ visible_from }}-block{% endif %}">
        <a href="{% if link %}{{ link }}{% else %}{{ url_for(endpoint, **kwargs) }}{% endif %}"
           class="nav-link text-light">{% if icon %}
            <i class="bi {{ icon }}"></i><br>{% endif %}{% if text %}{{ text|safe }}{% endif %}</a>
        {% if badge_text %}
            <span class="position-absolute top-0 start-50 translate-middle badge rounded-pill bg-danger">{{ badge_text }}</span>
        {% endif %}
    </li>
{% endmacro %}


{% macro render_navbar_bottom(current_user=None) %}
    <div class="container-fluid fixed-bottom bg-secondary">
        <ul class="nav justify-content-center">
            {% if current_user and current_user.is_authenticated %}
                {{ render_nav_item_bottom("main.alerts", "Alerts", "bi-bell", badge_text=5) }}
                {{ render_nav_item_bottom("main.browse", "Browse", "bi-search") }}
                {{ render_nav_item_bottom("main.new_post", "Post", "bi-plus-square") }}
                {{ render_nav_item_bottom("main.account", "&nbsp&nbspMe&nbsp&nbsp", "bi-person-circle") }}
                {{ render_nav_item_bottom("main.conversations", "Chats", "bi-chat-square-text", "sm") }}
                {{ render_nav_item_bottom("main.saved", "Saved", "bi-bookmark-check", "sm") }}
            {% else %}
                {{ render_nav_item_bottom(link="https://twitter.com/KnowbleApp", icon="bi-twitter") }}
                {{ render_nav_item_bottom(link="https://fb.me/KnowbleApp", icon="bi-facebook") }}
                {{ render_nav_item_bottom(link="https://www.linkedin.com/company/knowbleapp", icon="bi-linkedin") }}
                {{ render_nav_item_bottom(link="https://discord.gg/xtXCScr9", icon="bi-discord") }}
                {{ render_nav_item_bottom(link="mailto:info@lumiask.com", icon="bi-envelope-fill") }}
            {% endif %}
        </ul>
    </div>
{% endmacro %}


{% macro render_user(user, capitalize=True) %}
    <a class="text-decoration-none text-muted" href="{{ url_for("main.user", user_id=user.id) }}">
        {% if user == current_user %}{{ "You" if capitalize else "you" }}{% else %}A user{% endif %}
    </a>
{% endmacro %}

{% macro render_tag(tag, tags_in_filter=[], freq=None, extra_class="", ignore_ids=['buying', 'selling']) %}
    {% if tag.id not in ignore_ids %}
        <a class="badge rounded-pill border text-decoration-none
        bg-{{- 'info' if tag.id == 'buying' else ('warning' if tag.id == 'selling' else 'light') }}
        text-dark {{ extra_class }}" href="
        {% if tag in tags_in_filter %}
            {{ url_for("main.browse", tags=tags_in_filter|select('ne', tag)|join('+', attribute='name')) }}
        {% else %}
            {{ url_for("main.browse", tags=([tag] + tags_in_filter)|join('+', attribute='name')) }}
        {% endif %}
        ">#{{ tag.name }} {% if freq %}
            <span class="badge bg-secondary opacity-75 rounded-pill">{{ freq }}</span>{% endif %}
        </a>
    {% endif %}
{% endmacro %}

{% macro render_post_card(post, truncate_body=False, post_badges=True, post_tags=True, tag_limit=None,
    style_map={'buy':'info', 'sell':'warning', 'announcement':'success'},
    label_map={'buy':'Buying', 'sell':'Selling', 'announcement':'Announcement'}) %}
    <div class="card mb-3 {{ style_map[post.type] }}">
        <div class="card-body py-2">
            <p class="small text-muted mb-1">{{ render_user(post.creator) }}
                posted {{ moment(post.timestamp).fromNow() }}</p>
            <div class="card-title">
                <div class="btn-group btn-group-sm buy-sell" role="group">
                    <a href="{{ url_for("main.browse", tags=post.type+'ing' if post.type in ['buy', 'sell'] else '') }}"
                       class="btn btn-{{- style_map[post.type] -}}">
                        {{ label_map[post.type] }}
                    </a>
                    {% if post.reward > 0 %}
                        <button type="button" class="btn btn-secondary" disabled>
                            {{ "$%.0f"|format(0.01 * post.reward) }}
                        </button>
                    {% endif %}
                </div>
                <a class="text-decoration-none text-dark" style="vertical-align: middle"
                   href="{{ url_for("main.view_post", post_id=post.id) }}">
                    <b>{{ post.title }}</b>
                </a>
                {% if post_tags %}
                    {#                    <p class="my-1">#}
                    {% for post_tag in post.post_tags[:tag_limit] %}
                        {{ render_tag(post_tag.tag) }}
                    {% endfor %}
                    {#                    </p>#}
                {% endif %}
            </div>
            {% if truncate_body %}
                <a class="text-decoration-none text-dark small"
                   href="{{ url_for("main.view_post", post_id=post.id) }}">
            {% endif %}
            <div class="card-text {{ 'truncated' if truncate_body }}">
                {% if post.body_html %}
                    {{ post.body_html | safe }}
                {% else %}
                    {{ post.body[1:] }}
                {% endif %}
            </div>
            {% if truncate_body %}
                </a>
            {% endif %}
        </div>
        {% if post_badges %}
            <div class="card-footer py-0">
                <a href="{{ url_for("main.view_post", post_id=post.id) }}"
                   class="btn btn-sm btn-outline-dark border-0 mx-0 my-0 rounded-0">
                    <b>Chat</b>
                </a>
                <a href="{{ url_for("main.view_post", post_id=post.id) }}"
                   class="btn btn-sm btn-outline-dark border-0 mx-0 my-0 rounded-0">
                    <b>Share</b>
                </a>
                <a href="{{ url_for("main.view_post", post_id=post.id) }}"
                   class="btn btn-sm btn-outline-dark border-0 mx-0 my-0 rounded-0">
                    <b>Comment</b>
                </a>
                <a href="{{ url_for("main.view_post", post_id=post.id) }}"
                   class="btn btn-sm btn-outline-dark border-0 mx-0 my-0 rounded-0">
                    <b>Report</b>
                </a>
            </div>
        {% endif %}
    </div>
{% endmacro %}
